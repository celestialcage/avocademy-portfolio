<!doctype html>
<html lang="ko" data-bs-theme="auto" xmlns:th="http://www.thymeleaf.org">
<head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==
" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <th:block th:insert="~{./fragments.html :: headTag}"></th:block>   
  <!-- Custom styles for this template -->
  
	<style type="text/css">
  	.mainContents {
  		margin: 0 auto;
  		height: auto;
  		min-height: 600px;
  		}
  	</style>
  	
	<script type="text/javascript"> 	
$(function(){
	//로그인 버튼 클릭시 
	$('.check').click(function(){
		let id = $('#id').val();
		let pw = $('#pw').val();
		
			if(id == ''|| id.length< 4){
				alert('올바른 아이디를 입력하세요');
				return false;
			}
			
			if(pw == '' || pw.length < 4){
				alert('비밀번호가 틀렸습니다.')
				return false;
			}
			
			if($('#saveID').is(':checked')){
				alert("아이디 저장을 눌렀습니다.");
				
				setCookie('setCookieYN', 'Y', 60);
				setCookie("userInputId", id, 60);
			} else { 
				delCookie('userInputId');
				delCookie('setCookieYN');
			}
			$('#loginForm').submit();
			
		
	});
	
	//로그아웃 버튼 클릭
	$('.logout').click(function(){
		delCookie('loginCookie');
		logout();
	});
});

//쿠키 저장하는 함수(쿠키 이름, 값, 기한)
function setCookie(cookieName, value, exdays){
	let date = new Date();
	date.setDate(date.getDate()+exdays);
	let value2 = escape(value)+"; expires=" + date.toGMTString();
	document.cookie = cookieName + "=" + value2;
}


//쿠키 가져오는 함수
function getCookie(cookieName) {
    let cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
        let cookie = cookies[i].trim();
        if (cookie.startsWith(cookieName + '=')) {
            return cookie.substring(cookieName.length + 1);
        }
    }
    return null;
}

//로그아웃 처리 함수
function logout(){
	location.reload();
}


//쿠키 삭제
function delCookie(cookieName){
	document.cookie = cookieName + "=; max-age=0";
}

$(function(){
	let userInputId  = getCookie('userInputId ');
	$('#id').val(userInputId);
});


// 페이지 로딩 시간 기록
localStorage.setItem('lastLoginTime', new Date().getTime());

// 세션 만료 시간 설정 (밀리초 단위)
const sessionExpirationTime = 60 * 60 * 1000; // 1시간

// 세션 만료 여부 확인 함수
function checkSessionExpiration() {
    let lastLoginTime = localStorage.getItem('lastLoginTime');
    if (lastLoginTime) {
        let currentTime = new Date().getTime();
        if (currentTime - lastLoginTime > sessionExpirationTime) {
            logout();
        }
    }
}

// 세션 만료까지 남은 시간 표시 함수
function updateSessionTimeLeft() {
    let lastLoginTime = localStorage.getItem('lastLoginTime');
    if (lastLoginTime) {
        let currentTime = new Date().getTime();
        let timeDiff = sessionExpirationTime - (currentTime - lastLoginTime);
        let minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
        let seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
        $('#sessionTimeLeft').text(minutes + "분 " + seconds + "초 남음");
    }
}

// 페이지 로드 후 매 초마다 업데이트
$(document).ready(function () {
    updateSessionTimeLeft();
    setInterval(updateSessionTimeLeft, 1000);
    setInterval(checkSessionExpiration, 1000);
});
</script>
  	
</head>
<body>
	<th:block th:insert="~{./fragments.html :: menu}"></th:block>
 <section class="page-section" id="login" style="margin-top: 100px;">

      <div class="container">
         <div class="row">
            <div class="col-md-4 mx-auto">
               <form action="./login" method="post" id="loginForm">
                  <h2 class="text-center text-uppercase text-primary mb-4">LOGIN</h2>

                  <div class="form-group">
                  <!-- <label id="id"></label> -->
				 <input type="text" id="id" name="id" class="form-control" placeholder="아이디" autocomplete="username">
                  </div>
                  

                  <div class="form-group">
                    <input type="password" id="pw" name="pw" class="form-control" placeholder="비밀번호" autocomplete="current-password">

                  </div>
            
                  
                 <div class="mb-3 row">
                  	<div class="col-sm-12 text-start">
                  		<input type="checkbox" class="saveID" id="saveID">
                  		<label for="saveID">아이디 저장</label>
                  	</div>
                 </div> 
                 
                 <div class="mb-3 row">
                     <div class="col-sm-12">
                        <div class="form-group text-center">
                           <button type="reset" class="btn btn-danger mr-2">초기화</button>
                           <button type="submit" class="btn btn-primary check">로그인</button>
                        </div>                       
                     </div>
                 </div>	
               </form>
            </div>
         </div>
      </div>
   </section>

	 <!-- 자바스크립트 추가 -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
        crossorigin="anonymous"></script>

	<!-- FOOTER -->
	<th:block th:insert="~{./fragments.html :: footer}"></th:block>
<script src="/index/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
</body>
</html>
